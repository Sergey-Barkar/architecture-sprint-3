@startuml
title Целевой Уровень Кода Сервиса Коммуникации Устройств Системы Управления Умным Домом

package "Device Communication Service" 
{
	interface IAction
	{
		+GUID getId();
		+ICommunicationProtocol getCommunicationProtocol();
	}
	
	interface IActionResult
	{
		+ActionResultType getResultType();
	}
	
	class DeviceCommunicationController 
	{
		-kafkaClient;
		-void sendActionResult(IActionResult);
		+IAction receiveAction();
		+IActionResult handleAction(IAction);
	}
	
	class DeviceCommunicationService {
		-deviceCommunicationController;
		+IActionResult handleAction(SerializedAction);
    }
	
	class KafkaClient 
	{
		-producer;
		-consumer;
		+async boolean tryToProduceMessageAsync(IMessage);
		+async IMessage tryToConsumeMessageAsync();
    }
	
	interface IMessage
	{
		str getTopic();
		str getMessage();
	}

	DeviceCommunicationService --> DeviceCommunicationController
	DeviceCommunicationController --> KafkaClient : Send an action result into kafka
	DeviceCommunicationController <-- KafkaClient : Receive an action from kafka
	DeviceCommunicationController --o IAction
	DeviceCommunicationController --o IActionResult
	KafkaClient --o IMessage
}

package "ApiGateway service" {}

DeviceCommunicationController --> "ApiGateway service" : "Sends a request by an action to a device"
DeviceCommunicationService <-- "ApiGateway service" : "Gets an action generated by users GUI to specific device"

@enduml